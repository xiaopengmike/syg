<!--pages/bind/bind.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-icon">â³</view>
    <text class="loading-text">åŠ è½½é‚€è¯·ä¿¡æ¯...</text>
  </view>

  <!-- é‚€è¯·å¤±æ•ˆ -->
  <view class="error-state" wx:elif="{{!isValid}}">
    <view class="error-icon">ğŸ˜”</view>
    <text class="error-title">é‚€è¯·å·²å¤±æ•ˆ</text>
    <text class="error-message">{{errorMessage}}</text>
    <button class="btn-home" bindtap="goHome">è¿”å›é¦–é¡µ</button>
  </view>

  <!-- æœ‰æ•ˆé‚€è¯· -->
  <view class="bind-form" wx:else>
    <!-- é‚€è¯·ä¿¡æ¯å¡ç‰‡ -->
    <view class="invite-card">
      <view class="invite-header">
        <view class="invite-icon">ğŸ’Œ</view>
        <text class="invite-title">é‚€è¯·ä¿¡æ¯</text>
      </view>
      <view class="invite-content">
        <view class="inviter-info">
          <text class="inviter-label">ğŸ‘¤ {{inviteInfo.inviterName}} é‚€è¯·æ‚¨</text>
          <text class="inviter-role">æˆä¸ºã€Œ{{inviteInfo.targetRole === 'teacher' ? 'è€å¸ˆ' : 'å­¦ç”Ÿ'}}ã€</text>
        </view>
        <view class="divider"></view>
        <view class="target-info">
          <view class="info-row">
            <text class="info-label">å§“å</text>
            <text class="info-value">{{inviteInfo.targetName}}</text>
          </view>
          <view class="info-row" wx:if="{{inviteInfo.subject}}">
            <text class="info-label">ç§‘ç›®</text>
            <text class="info-value">{{inviteInfo.subject}}</text>
          </view>
          <view class="info-row" wx:if="{{inviteInfo.className}}">
            <text class="info-label">ç­çº§</text>
            <text class="info-value">{{inviteInfo.className}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç»‘å®šè¡¨å• -->
    <view class="form-card">
      <view class="form-title">å®Œæˆç»‘å®š</view>
      
      <!-- IDè¾“å…¥ -->
      <view class="input-group">
        <view class="input-icon">ğŸ“±</view>
        <input 
          class="input" 
          type="number" 
          maxlength="11"
          placeholder="è¯·è¾“å…¥ID" 
          value="{{phone}}"
          bindinput="onPhoneInput"
        />
      </view>

      <!-- å¯†ç  -->
      <view class="input-group">
        <view class="input-icon">ğŸ”’</view>
        <input 
          class="input" 
          type="{{showPassword ? 'text' : 'password'}}" 
          placeholder="è®¾ç½®ç™»å½•å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" 
          value="{{password}}"
          bindinput="onPasswordInput"
        />
        <view class="input-suffix" bindtap="togglePassword">
          <text>{{showPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸'}}</text>
        </view>
      </view>

      <!-- ç¡®è®¤å¯†ç  -->
      <view class="input-group">
        <view class="input-icon">ğŸ”’</view>
        <input 
          class="input" 
          type="{{showPassword ? 'text' : 'password'}}" 
          placeholder="ç¡®è®¤ç™»å½•å¯†ç " 
          value="{{confirmPassword}}"
          bindinput="onConfirmPasswordInput"
        />
      </view>

      <!-- ç»‘å®šæŒ‰é’® -->
      <button 
        class="btn-bind {{isSubmitting ? 'disabled' : ''}}" 
        bindtap="handleBind"
        disabled="{{isSubmitting}}"
      >
        {{isSubmitting ? 'ç»‘å®šä¸­...' : 'ç¡®è®¤ç»‘å®š'}}
      </button>

      <!-- å·²æœ‰è´¦å· -->
      <view class="login-link" bindtap="goToLogin">
        <text>å·²æœ‰IDï¼Ÿ</text>
        <text class="link">å»ç™»å½•</text>
      </view>
    </view>
  </view>
</view>
