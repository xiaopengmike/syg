# 项目概述

## 项目名称
微信小程序排课系统

## 项目描述

基于微信云开发的排课系统，支持多角色管理。系统面向教育机构，提供课程表创建、管理和冲突检测功能，帮助学校高效管理课程安排。

### 核心功能
1. **课程表管理**：创建、编辑、查看课程表，支持周视图（8:00-22:00）。
2. **冲突检测**：自动检测时间、教师、学生等资源冲突。
3. **多角色支持**：校长、老师、学生三种角色，不同权限。
4. **教师/学生管理**：支持校长/老师管理关联的教师和学生。
5. **学生课表查询**：支持校长通过课程表页面筛选器查看任意学生的专属课表。

### 用户角色
- **校长**：拥有最高权限，可以管理所有排课、教师、学生。支持按教师筛选全局课表。
- **老师**：可以查看自己的课程表，排课，管理自己创建的学生。支持查看学生的课表。
- **学生**：可以查看自己的课程表，选课。

### 权限矩阵

| 功能 | 校长 | 老师 | 学生 |
|-----|-----|-----|-----|
| 我的老师 | ✅ 查看全部 | ❌ | ❌ |
| 我的学生 | ✅ 查看全部 | ✅ 仅自己创建的 | ❌ |
| 添加老师 | ✅ | ❌ | ❌ |
| 添加学生 | ✅ | ✅ | ❌ |
| 查看学生课表 | ✅ 通过课程表筛选器 | ✅ 通过课程表筛选器 | ❌ |
| 课程表筛选 | ✅ 教师+学生筛选 | ❌ | ❌ |
| 排课管理 | ✅ | ✅ | ❌ |

## 技术栈

* **平台**：微信小程序
* **后端**：微信云开发（云函数、云数据库、云存储）
* **语言**：JavaScript/TypeScript
* **UI框架**：微信小程序原生组件 + 自定义渐变色主题

## 项目结构

```
miniprogram/
├── pages/              # 页面目录
│   ├── index/         # 首页（功能入口）
│   ├── login/         # 登录页
│   ├── register/      # 注册页
│   ├── bind/          # 邀请绑定页
│   ├── users/         # 用户管理
│   │   ├── list/     # 用户列表（我的老师/我的学生）
│   │   ├── add/      # 添加用户
│   │   └── detail/   # 用户详情
│   ├── schedule/      # 课程表模块
│   │   ├── index/    # 课程表首页（周视图）
│   │   ├── create/   # 创建/编辑排课
│   │   └── detail/   # 课程详情
│   └── profile/       # 个人中心
├── components/         # 组件目录
│   ├── schedule-grid/ # 周视图网格组件
│   └── schedule-card/ # 课程卡片组件
├── utils/             # 工具函数
│   ├── auth.js       # 权限验证
│   ├── api.js        # API封装
│   └── util.js       # 通用工具
├── app.js            # 小程序入口
├── app.json          # 小程序配置
└── app.wxss          # 全局样式

cloud/functions/        # 云函数目录
└── user/              # 用户相关
└── schedule/          # 排课相关
```

## 开发约定

### 代码风格
* 遵循微信小程序官方代码规范
* 使用 ES6+ 语法
* 课程卡片颜色按教师自动分配（8种渐变色）

### 命名规范
* **文件命名**：使用 kebab-case
* **变量/函数命名**：使用 camelCase
* **数据库集合**：使用复数形式（`users`, `schedules`, `invites`）

## 功能模块

### 1. 用户认证模块 ✅ 已完成
- 账号（手机号）+ 密码登录
- 自主注册（老师/学生）
- 邀请绑定流程
- 角色识别与权限验证

### 2. 排课模块 ✅ 已完成
- 周视图（8:00-22:00）全屏展示
- 创建/编辑/删除课程
- 教师筛选（校长视角）
- **学生筛选器**：校长可在课程表页面并排筛选教师和学生
- **学生名显示**：课程卡片直接显示首位学生姓名文字（移除图标）
- **学生课表模式**：支持按学生筛选查看其个人课表

### 3. 用户管理模块 ✅ 已完成
- 老师列表/学生列表独立入口管理
- 用户详情与操作功能

### 4. 冲突检测模块 ✅ 已完成
- 教师时间冲突检测
- 学生时间冲突检测
- 冲突提示与阻止创建

### 5. UI优化模块 ✅ 已完成
- 课程表学生筛选器
- 学生列表隐藏课表按钮
- 创建页面按钮悬浮
- 时间分割线优化

## 用户故事

### 故事 1：系统初始化

```
┌─────────────────────────────────────────────────────────────────┐
│  系统部署后，数据库自动初始化一个校长账号                          │
│  校长使用预设账号 + 密码登录系统                                   │
└─────────────────────────────────────────────────────────────────┘
```

**场景**：学校管理员首次使用系统
1. 系统预置一个校长账号（18871458537 + 123456）
2. 校长用微信扫码打开小程序
3. 使用预置账号和密码登录
4. 登录后进入校长管理界面

### 故事 2：校长添加老师/学生

```
┌──────────┐     ┌──────────────┐     ┌──────────────┐
│  校长    │────▶│  用户管理页   │────▶│  添加老师    │
│  登录    │     │              │     │  填写姓名等  │
└──────────┘     └──────────────┘     └──────────────┘
                                             │
                        ┌────────────────────┘
                        ▼
                 ┌──────────────┐
                 │  老师记录    │ ← 此时为"待绑定"状态
                 │  已创建      │
                 └──────────────┘
```

**场景**：校长为学校添加老师
1. 校长进入「我的老师」页面
2. 点击「+」按钮，进入添加老师页
3. 填写老师姓名、教授科目等信息
4. 提交后，系统创建一条老师记录（状态：待绑定）

### 故事 3：邀请微信用户绑定

```
┌──────────┐     ┌──────────────┐     ┌──────────────┐
│  用户    │────▶│  点击具体    │────▶│  直接触发    │
│  列表    │     │  老师/学生   │     │  微信分享    │
└──────────┘     └──────────────┘     └──────────────┘
                                             │
                        ┌────────────────────┘
                        ▼
                 ┌──────────────┐     ┌──────────────┐
                 │  选择微信    │────▶│  微信好友    │
                 │  好友/群      │     │  点击卡片    │
                 └──────────────┘     └──────────────┘
```

**场景**：校长邀请真实用户绑定老师身份
1. 校长在用户列表中点击某个老师记录
2. 进入老师详情页，点击「邀请绑定」
3. 系统直接弹出微信「选择聊天」对话框
4. 校长选择好友后，发送包含邀请码的小程序卡片
5. 对方点击卡片进入绑定流程

### 故事 4：用户接受邀请并绑定

```
┌──────────┐     ┌──────────────┐     ┌──────────────┐
│  微信    │────▶│  打开卡片    │────▶│  输入手机号  │
│  用户    │     │  绑定页面    │     │  设置密码    │
└──────────┘     └──────────────┘     └──────────────┘
                                             │
                        ┌────────────────────┘
                        ▼
                 ┌──────────────┐     ┌──────────────┐
                 │  确认绑定    │────▶│  绑定成功    │
                 │              │     │  自动登录    │
                 └──────────────┘     └──────────────┘
```

**场景**：老师接受邀请绑定账号
1. 老师点击微信卡片进入绑定页
2. 显示邀请人信息和被邀请岗位
3. 输入手机号并设置密码
4. 点击「确认绑定」，记录变为「已绑定」状态
5. 系统自动登录并进入首页

### 故事 5：老师/学生自主注册

```
┌──────────┐     ┌──────────────┐     ┌──────────────┐
│  微信    │────▶│  登录页      │────▶│  填写信息    │
│  用户    │     │  点击注册    │     │  选择角色    │
└──────────┘     └──────────────┘     └──────────────┘
                                             │
                        ┌────────────────────┘
                        ▼
                 ┌──────────────┐     ┌──────────────┐
                 │  提交注册    │────▶│  注册成功    │
                 │              │     │  成为独立用户│
                 └──────────────┘     └──────────────┘
```

**场景**：老师或学生自行注册
1. 用户进入登录页，点击「立即注册」
2. 选择「我是老师」或「我是学生」
3. 输入账号、姓名、密码等信息
4. 提交注册后，状态为「已注册」（独立用户）
5. 注册成功后自动登录

### 故事 6：查看学生课表

```
┌──────────┐     ┌──────────────┐     ┌──────────────┐
│  校长    │────▶│  课程表页    │────▶│  选择学生    │
│  登录    │     │  面          │     │  筛选器      │
└──────────┘     └──────────────┘     └──────────────┘
                                             │
                        ┌────────────────────┘
                        ▼
                 ┌──────────────┐     ┌──────────────┐
                 │  自动筛选    │────▶│  显示该生    │
                 │  该生课程    │     │  专属课表    │
                 └──────────────┘     └──────────────┘
```

**场景**：校长查看某个学生的个人课程安排
1. 校长登录后进入「课程表」页面
2. 在顶部筛选器中选择目标学生
3. 页面自动筛选显示该学生参与的所有课程
4. 教师筛选器可进一步筛选该学生在特定教师处的课程

## 参考资料
* [微信小程序官方文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
* [微信云开发文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)
