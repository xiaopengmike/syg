# 变更提案 007：学生自注册审批功能

## 概述

支持学生自行注册账号，但需要校长审批后才能正常使用系统。

## 背景

当前系统支持学生自主注册，注册后即可直接使用。为了让学校更好地管理学生账号，需要增加审批机制。

## 功能需求

### 1. 学生注册流程变更

- 学生自主注册时，状态变为 `pending_approval`（待审批）
- 注册成功后提示"注册成功，请等待校长审批"
- 待审批状态的学生无法正常使用系统功能

### 2. 校长审批功能

- 校长首页增加"注册审批"入口，显示待审批数量徽章
- 审批列表页面展示所有待审批的学生
- 支持批准和拒绝操作
- 批准后学生状态变为 `registered`（已注册）
- 拒绝后可选择删除记录或标记为 `rejected`（已拒绝）

### 3. 状态流转

```
学生注册 → pending_approval（待审批）
                ↓ 校长批准
           registered（已注册）→ 可正常使用
                ↓ 校长拒绝
           rejected（已拒绝）→ 无法登录
```

## 技术方案

### 数据库变更

users 集合新增 `bindStatus` 值：
- `pending_approval`: 待审批（学生自注册）
- `rejected`: 已拒绝

### 云函数变更

1. **register.js** - 学生注册时 `bindStatus` 设为 `pending_approval`
2. **approve.js** (新增) - 处理审批操作（批准/拒绝）
3. **pending.js** (新增) - 获取待审批学生列表
4. **login.js** - 检查待审批/已拒绝状态，阻止登录

### 前端页面

1. **注册页** - 学生注册成功后显示审批提示
2. **首页** - 校长显示审批入口和待审批数量
3. **审批列表页** (新增) - 展示待审批学生，支持批准/拒绝
4. **用户列表页** - 支持显示待审批状态

## 权限控制

| 操作 | 校长 | 老师 | 学生 |
|-----|-----|-----|-----|
| 查看待审批列表 | ✅ | ❌ | ❌ |
| 批准学生注册 | ✅ | ❌ | ❌ |
| 拒绝学生注册 | ✅ | ❌ | ❌ |

## 用户故事

### 学生自注册并等待审批

```
┌──────────┐     ┌──────────────┐     ┌──────────────┐
│  学生    │────▶│  注册页面    │────▶│  填写信息    │
│  打开    │     │              │     │  提交注册    │
└──────────┘     └──────────────┘     └──────────────┘
                                             │
                        ┌────────────────────┘
                        ▼
                 ┌──────────────┐     ┌──────────────┐
                 │  提示等待    │     │  无法登录    │
                 │  校长审批    │     │  直到批准    │
                 └──────────────┘     └──────────────┘
```

### 校长审批学生注册

```
┌──────────┐     ┌──────────────┐     ┌──────────────┐
│  校长    │────▶│  首页看到    │────▶│  进入审批    │
│  登录    │     │  审批徽章    │     │  列表页面    │
└──────────┘     └──────────────┘     └──────────────┘
                                             │
                        ┌────────────────────┘
                        ▼
                 ┌──────────────┐     ┌──────────────┐
                 │  查看学生    │────▶│  批准/拒绝   │
                 │  信息        │     │  操作        │
                 └──────────────┘     └──────────────┘
```

## 实现清单

- [ ] 云函数 register.js 修改
- [ ] 云函数 approve.js 新增
- [ ] 云函数 pending.js 新增
- [ ] 云函数 login.js 修改
- [ ] 云函数 index.js 路由更新
- [ ] 前端注册页面修改
- [ ] 前端首页添加入口
- [ ] 前端审批列表页新增
- [ ] 用户列表状态显示更新
